================================================================================
  MULTI-AGENT STOCK MARKET AI AUTONOMITY â€” FULL PROJECT REPORT (Phase 2)
================================================================================
  Project  : Multi-Agent Stock Market AI Autonomity
  Repo     : https://github.com/dhanushkumar-karuppasamy/Stock_Market_Autonomity
  Purpose  : DevHack 2026 Phase-2 "Agentic AI" submission
  Date     : February 2026
================================================================================


TABLE OF CONTENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1.  Project Overview
  2.  Architecture Diagram
  3.  Tech Stack
  4.  Directory Structure
  5.  Backend â€” Detailed Breakdown
      5.1   Flask API (app.py)
      5.2   Simulation Facade (simulation/simulation.py)
      5.3   OrchestratorAgent â€” Head Agent (simulation/orchestrator.py)
      5.4   Market Engine (market/market.py)
      5.5   Base Agent â€” Agentic Pipeline (agents/base_agent.py)
      5.6   Conservative Agent (agents/conservative_agent.py)
      5.7   Momentum Agent (agents/momentum_agent.py)
      5.8   Mean-Reversion Agent (agents/mean_reversion_agent.py)
      5.9   Noise Trader (agents/noise_trader.py)
      5.10  Adversarial Agent (agents/adversarial_agent.py)
      5.11  Regulator Agent (regulator/regulator.py)
      5.12  Simulation Logger (logging_utils/logger.py)
      5.13  SQLite Database Layer (db.py)
  6.  Frontend â€” Detailed Breakdown
      6.1   Entry Point & App Shell
      6.2   API Client
      6.3   TopBar
      6.4   LeftSidebar (Tab Navigation)
      6.5   RightTradePanel (Controls)
      6.6   PriceChart (TradingView Lightweight Charts v5)
      6.7   MarketPanel
      6.8   AgentsPanel
      6.9   StatsPanel
      6.10  HelpPanel
      6.11  RiskOverviewPanel
      6.12  PerformanceCharts
      6.13  TradeLogTable
      6.14  RegulationLogTable
      6.15  SettingsModal
      6.16  CSS / Theming
  7.  All Features List
  8.  REST API Reference
  9.  Database Schema
  10. Agent Interaction Flow
  11. Agentic AI Pipeline (Perceive â†’ Reason â†’ Act)
  12. DevHack 2026 Phase-2 Compliance
  13. Phase 2 Enhancements (What Changed from Phase 1)
  14. How to Run
  15. Dependencies


================================================================================
1. PROJECT OVERVIEW
================================================================================

This project is a **Multi-Agent Stock Market AI Autonomy Simulator** â€” a
full-stack application where multiple autonomous trading agents compete in a
simulated stock market powered by real historical data (via yfinance).

Each agent has a unique strategy, its own â‚¹1,00,000 cash allocation, and
operates independently using a structured **Perceive â†’ Reason â†’ Act** agentic
pipeline.  A central Orchestrator (Head Agent) coordinates the step-by-step
simulation, while a Regulator agent enforces compliance rules.  Every trade
and regulation event is logged to both in-memory lists (for real-time UI) and
a SQLite database (for persistent post-hoc analysis).

The system is NOT a chatbot â€” it is an autonomous, goal-driven multi-agent
decision-making system where agents perceive market state, apply rule-based
reasoning to produce structured decisions, act on those decisions, and are
subject to regulatory oversight.  Every agent maintains a memory buffer of
past observations and performance statistics.


================================================================================
2. ARCHITECTURE DIAGRAM
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  React Frontend (Vite + TradingView v5)         â”‚
    â”‚                                                                  â”‚
    â”‚  TopBar Â· LeftSidebar Â· PriceChart Â· MarketPanel Â· AgentsPanel  â”‚
    â”‚  StatsPanel Â· HelpPanel Â· RightTradePanel Â· RiskOverview        â”‚
    â”‚  TradeLogTable Â· RegulationLogTable Â· PerformanceCharts         â”‚
    â”‚                                                                  â”‚
    â”‚  3-Column Layout: 72px sidebar | 1fr center | 310px controls    â”‚
    â”‚  5-Tab Navigation: Trades Â· Market Â· Agents Â· Stats Â· Help      â”‚
    â”‚  Themes: Dark (neon terminal) + Light                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚  REST API (axios)
                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     Flask Backend (app.py)                       â”‚
    â”‚   /api/init  /api/step  /api/auto-step  /api/jump  /api/state   â”‚
    â”‚   /api/trigger-crash                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              Simulation (facade / thin wrapper)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚  delegates all calls to
                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           OrchestratorAgent (HEAD AGENT / ORCHESTRATOR)          â”‚
    â”‚                                                                  â”‚
    â”‚   Owns simulation clock Â· Coordinates agents Â· Manages risk      â”‚
    â”‚   Triggers circuit breakers Â· Handles crash events               â”‚
    â”‚                                                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚   â”‚ Market   â”‚  â”‚ Agents   â”‚  â”‚  Regulator   â”‚                  â”‚
    â”‚   â”‚ Engine   â”‚  â”‚ (5 types)â”‚  â”‚  (Compliance) â”‚                  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
    â”‚                                                                  â”‚
    â”‚   Agent Pipeline per step:                                       â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚ Perceive â”‚   â”‚  Reason  â”‚   â”‚   Act    â”‚   â”‚  Regulate  â”‚  â”‚
    â”‚   â”‚(features)â”‚   â”‚(decision)â”‚   â”‚(execute) â”‚   â”‚(compliance)â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚   â”‚  SimulationLogger â”‚  â”‚    SQLite Database   â”‚                â”‚
    â”‚   â”‚  (in-memory)      â”‚  â”‚    (devhack.db)      â”‚                â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
3. TECH STACK
================================================================================

  Backend:
    â€¢ Python 3.11+
    â€¢ Flask â‰¥ 3.0            (REST API framework)
    â€¢ Flask-CORS â‰¥ 4.0       (cross-origin for React dev server)
    â€¢ yfinance â‰¥ 0.2         (real-time & historical market data)
    â€¢ pandas â‰¥ 2.0           (data manipulation, technical indicators)
    â€¢ numpy â‰¥ 1.24           (numerical computations)
    â€¢ sqlite3                (built-in, persistent storage)

  Frontend:
    â€¢ React 18.3             (UI framework)
    â€¢ Vite 5.4               (build tool / dev server)
    â€¢ TradingView Lightweight Charts 5.1  (professional candlestick charting)
    â€¢ Recharts 2.12          (portfolio performance + violation bar charts)
    â€¢ Axios 1.7              (HTTP client)

  Fonts:
    â€¢ Space Grotesk          (headings)
    â€¢ Inter                  (body text)
    â€¢ JetBrains Mono         (data / monospace)

  Database:
    â€¢ SQLite (devhack.db)    â€” 3 tables: runs, trades, regulation_events


================================================================================
4. DIRECTORY STRUCTURE
================================================================================

  Stock_Market_Autonomity/
  â”œâ”€â”€ README.md
  â”œâ”€â”€ PROJECT_REPORT.txt              â† this file
  â”œâ”€â”€ VIDEO_SCRIPT.md                 â† Phase 2 demo video script
  â”‚
  â”œâ”€â”€ backend/
  â”‚   â”œâ”€â”€ app.py                      â† Flask API entry point
  â”‚   â”œâ”€â”€ db.py                       â† SQLite database layer
  â”‚   â”œâ”€â”€ requirements.txt            â† Python dependencies
  â”‚   â”œâ”€â”€ devhack.db                  â† SQLite DB file (auto-created)
  â”‚   â”‚
  â”‚   â”œâ”€â”€ simulation/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â”œâ”€â”€ simulation.py           â† Simulation facade (delegates to Orchestrator)
  â”‚   â”‚   â””â”€â”€ orchestrator.py         â† OrchestratorAgent (Head Agent)
  â”‚   â”‚
  â”‚   â”œâ”€â”€ agents/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â”œâ”€â”€ base_agent.py           â† TradingAgent base (Perceiveâ†’Reasonâ†’Act pipeline)
  â”‚   â”‚   â”œâ”€â”€ conservative_agent.py   â† ConservativeAgent
  â”‚   â”‚   â”œâ”€â”€ momentum_agent.py       â† MomentumAgent
  â”‚   â”‚   â”œâ”€â”€ mean_reversion_agent.py â† MeanReversionAgent
  â”‚   â”‚   â”œâ”€â”€ noise_trader.py         â† NoiseTrader
  â”‚   â”‚   â””â”€â”€ adversarial_agent.py    â† AdversarialAgent
  â”‚   â”‚
  â”‚   â”œâ”€â”€ regulator/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â””â”€â”€ regulator.py            â† RegulatorAgent (compliance enforcement)
  â”‚   â”‚
  â”‚   â”œâ”€â”€ market/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â””â”€â”€ market.py               â† MarketEnvironment (yfinance + indicators)
  â”‚   â”‚
  â”‚   â””â”€â”€ logging_utils/
  â”‚       â”œâ”€â”€ __init__.py
  â”‚       â””â”€â”€ logger.py               â† SimulationLogger (dual-write: memory + DB)
  â”‚
  â””â”€â”€ frontend/
      â”œâ”€â”€ index.html
      â”œâ”€â”€ package.json
      â”œâ”€â”€ vite.config.js
      â””â”€â”€ src/
          â”œâ”€â”€ main.jsx                â† React entry point
          â”œâ”€â”€ App.jsx                 â† Root component (state, handlers, layout)
          â”œâ”€â”€ index.css               â† Neon dark/light theme (1066 lines)
          â”œâ”€â”€ api/
          â”‚   â””â”€â”€ client.js           â† Axios API client
          â””â”€â”€ components/
              â”œâ”€â”€ TopBar.jsx          â† Sticky header (ticker, portfolio, theme toggle)
              â”œâ”€â”€ LeftSidebar.jsx     â† 72px icon sidebar (5 tabs navigation)
              â”œâ”€â”€ RightTradePanel.jsx â† 310px controls panel (buttons, sliders, agents)
              â”œâ”€â”€ PriceChart.jsx      â† TradingView v5 chart + scrubber
              â”œâ”€â”€ MarketPanel.jsx     â† Market overview (OHLC, indicators, volatility)
              â”œâ”€â”€ AgentsPanel.jsx     â† Rich agent cards (pipeline, history, metrics)
              â”œâ”€â”€ StatsPanel.jsx      â† Statistics dashboard (leaderboard, risk)
              â”œâ”€â”€ HelpPanel.jsx       â† In-app documentation (agents, pipeline, tech)
              â”œâ”€â”€ RiskOverviewPanel.jsx â† System-wide risk dashboard
              â”œâ”€â”€ PerformanceCharts.jsx â† Portfolio + violation charts (Recharts)
              â”œâ”€â”€ TradeLogTable.jsx   â† Filterable trade log table
              â”œâ”€â”€ RegulationLogTable.jsx â† Regulation event log table
              â””â”€â”€ SettingsModal.jsx   â† Per-agent parameter tuning modal


================================================================================
5. BACKEND â€” DETAILED BREAKDOWN
================================================================================


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.1  Flask API (app.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Entry point for the entire backend.  Creates one global Simulation instance
and exposes REST endpoints consumed by the React frontend.

Endpoints:
  POST /api/init          â†’ init_simulation()     â€” start/restart simulation
  POST /api/step          â†’ step_simulation()     â€” advance 1 or N steps
  POST /api/auto-step     â†’ auto_step_simulation() â€” batch N steps (max 200)
  POST /api/jump          â†’ jump_to_step()        â€” jump to specific step
  POST /api/trigger-crash â†’ trigger_crash()       â€” trigger crash event
  GET  /api/state         â†’ get_state()           â€” return current snapshot

Runs on: http://localhost:5000 (debug mode)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.2  Simulation Facade (simulation/simulation.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Thin wrapper class that preserves the original REST-API interface while
delegating all logic to the OrchestratorAgent.

Class: Simulation
  __init__()                â†’ creates SimulationDB + OrchestratorAgent
  init_simulation(...)      â†’ delegates to orchestrator.init(...)
  step_simulation()         â†’ delegates to orchestrator.run_step()
  batch_step(n)             â†’ delegates to orchestrator.batch_step(n)
  jump_to_step(target)      â†’ delegates to orchestrator.jump_to_step(target)
  trigger_crash()           â†’ delegates to orchestrator.trigger_crash()
  get_snapshot()            â†’ delegates to orchestrator.get_snapshot()


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.3  OrchestratorAgent â€” Head Agent (simulation/orchestrator.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

The central coordinator of the entire multi-agent system.  This is the
"Head Agent" required by DevHack 2026 guidelines.

Class: OrchestratorAgent

  Constructor:
    __init__(db: SimulationDB | None)

  Attributes:
    market              â€“ MarketEnvironment instance
    agents              â€“ list of TradingAgent instances (5 agents)
    regulator           â€“ RegulatorAgent instance
    logger              â€“ SimulationLogger (in-memory + DB dual-write)
    db                  â€“ SimulationDB (SQLite connection)
    run_id              â€“ UUID string identifying current run
    current_step        â€“ current bar index (simulation clock)
    max_steps           â€“ total bars in dataset
    ticker, period,     â€“ simulation parameters
    interval
    crash_active        â€“ whether crash event is in effect
    crash_mode_active   â€“ whether whale-crash cascade is running
    _crash_triggered_step â€“ step at which crash was triggered
    _pre_crash_price    â€“ price just before crash, for drop tracking
    trading_halted      â€“ True when global circuit breaker has fired
    GLOBAL_HALT_DRAWDOWN_PCT â€“ threshold for global halt (âˆ’15 %)
    circuit_breakers_active â€“ count of currently halted agents
    price_history       â€“ list of all price bars seen so far
    trades_at_step      â€“ trades executed in the latest step
    _peak_total_value   â€“ for global drawdown tracking
    _active_agent_keys  â€“ stored agent keys for reinit during jump (Phase 2)
    _agent_params       â€“ stored agent params for reinit during jump (Phase 2)

  Methods:

    init(ticker, period, interval, active_agents, agent_params) â†’ dict
      1. Downloads market data via yfinance
      2. Creates 5 trading agents (each with â‚¹1,00,000)
      3. Creates RegulatorAgent
      4. Generates UUID run_id, registers run in SQLite
      5. Attaches DB to logger for dual-write
      6. Stores _active_agent_keys and _agent_params for jump/reinit
      7. Resets all crash / halt state
      8. Returns initial snapshot

    run_step() â†’ dict
      Core step logic (8-step flow):
        Guard:  If trading_halted â†’ force all agents to HOLD, advance bar,
                return snapshot with "HALTED_BY_CIRCUIT_BREAKER" status
        Step 1: Get current market state (price, indicators)
        Step 2: For each active agent: call agent.step(state) which runs
                the Perceive â†’ Reason â†’ Act agentic pipeline internally.
                â€¢ On the crash-trigger step, the whale's pipeline is
                  overridden: perceive() runs, then act() is called directly
                  with the forced full-dump SELL action (bypassing reason())
        Step 3: Send each action to Regulator for compliance review
        Step 4: Apply APPROVED/WARN actions to agent portfolios
        Step 5: Log trades + regulation events (memory + SQLite)
        Step 6: Compute rewards and call agent.update_after_step() which
                updates performance_stats and memory
        Step 7: Check per-agent circuit breakers (>10 % drawdown â†’ halt)
                + global circuit breaker (>âˆ’15 % system drawdown â†’ halt all)
        Step 8: Advance market to next bar (endogenous price impact)

    _find_whale_agent() â†’ TradingAgent | None
      Returns the AdversarialAgent instance (the "whale")

    _is_whale(agent) â†’ bool
      True if agent is an AdversarialAgent

    _build_whale_dump(whale) â†’ dict
      Builds forced SELL action for 100 % of whale's holdings

    trigger_crash() â†’ dict
      Public entry point â€“ delegates to trigger_market_crash()

    trigger_market_crash() â†’ dict
      Whale Manipulation / Cascade Crash demo scenario:
        1. Ensures whale has a position (buys 90 % of cash if empty)
        2. Drops OHLC prices by 15-20 % from current step onward
        3. Recomputes all technical indicators
        4. Records pre-crash price, activates crash_mode_active
        5. Runs one step where whale's action is overridden to full dump
        6. Large negative net_volume flows through endogenous price model
        Result: subsequent ticks show momentum agents stop-lossing,
        and eventually the global circuit breaker fires.

    _build_agent_state(agent, close) â†’ dict
      Helper: builds {cash, positions, portfolio_value} for regulator

    batch_step(n=10) â†’ dict
      Runs up to n steps (max 200), returns final snapshot

    _reinit_without_download() â†’ None                         â˜… Phase 2 NEW
      Resets the entire simulation to step 0 WITHOUT re-downloading
      market data from yfinance.  Uses market.reset() to rewind the
      market environment, re-creates all 5 agents from stored config,
      creates a new DB run, and resets all crash/halt state.  Used by
      jump_to_step() for fast rewind.

    jump_to_step(target_step) â†’ dict                          â˜… Phase 2 CHANGED
      Rewinds (via _reinit_without_download + replay) or fast-forwards
      to target step.  During replay, DB writes are temporarily disabled
      (logger._db set to None) to prevent SQLite transaction errors.
      Restores DB connection in a try/finally block after replay.

    get_system_risk() â†’ dict
      Returns: total_exposure, total_aum, exposure_pct,
               open_positions_count, active_agents, violation_count,
               global_drawdown_pct, circuit_breakers_active, crash_active

    get_snapshot() â†’ dict
      Full JSON snapshot including:
        - head_agent: {name, role, current_step, max_steps, crash_active,
                       crash_mode_active, trading_halted,
                       circuit_breakers_active, run_id}
        - step, max_steps, ticker, period, interval, finished
        - current_bar, price_history
        - agents: [{name, cash, positions, portfolio_value, last_action,
                    last_reasoning, last_reason, goal, halted, active,
                    status, return_pct, max_drawdown_pct, sharpe_ratio,
                    memory_size, latest_memory, performance_stats}, ...]
        - trade_log, regulation_log, trades_at_step
        - system_risk, crash_active, crash_mode_active
        - trading_halted, trading_status ("ACTIVE" / "HALTED_BY_CIRCUIT_BREAKER")
        - circuit_breakers_active


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.4  Market Engine (market/market.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Downloads real market data and provides a step-based replay environment.

Function: download_market_data(ticker, period, interval) â†’ pd.DataFrame
  - Uses yfinance to download OHLCV data
  - Normalizes column names
  - Raises ValueError if no data available

Class: MarketEnvironment

  Constants:
    DEFAULT_SENSITIVITY = 1e-5    â† how strongly net volume impacts price

  __init__(ticker, period, interval, sensitivity_factor=DEFAULT_SENSITIVITY)
    - Downloads data
    - Pre-computes technical indicators:
        SMA20     â€“ 20-period simple moving average
        SMA50     â€“ 50-period simple moving average
        BB_MID    â€“ Bollinger midline (= SMA20)
        BB_UP     â€“ Upper Bollinger Band (SMA20 + 2Ïƒ)
        BB_LOW    â€“ Lower Bollinger Band (SMA20 âˆ’ 2Ïƒ)
        Volatility â€“ 20-period rolling std of log returns
    - Initializes current_price (simulated price) from first close
    - Initializes price_history_simulated list

  get_state() â†’ dict
    Returns: {current_bar, recent_window (last 50 bars), step, total_bars,
              simulated_price, price_history_simulated}

  step(net_volume) â†’ dict
    Advances market by 1 bar with endogenous price impact.
    Net agent order flow adjusts simulated price via sensitivity_factor.
    Returns dict with "finished" key.

  reset() â†’ None                                              â˜… Phase 2 NEW
    Resets current_step to 0, re-initializes current_price and
    price_history_simulated from first historical close.  No network
    call â€” reuses previously downloaded data.  Used by orchestrator's
    _reinit_without_download() for fast rewind during jump.

  is_done() â†’ bool
    True when at last bar.

  _bar_to_dict(idx) â†’ dict                                   â˜… Phase 2 NEW
    Converts a DataFrame row to a dict with OHLCV + indicators +
    SimulatedPrice.

  _build_step_state(idx) â†’ dict                              â˜… Phase 2 NEW
    Builds compact state dict with both historical and simulated
    prices + all technical indicators.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.5  Base Agent â€” Agentic Pipeline (agents/base_agent.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Abstract base class for all 5 trading agents.  Implements the
**Perceive â†’ Reason â†’ Act** agentic pipeline.

Class: TradingAgent

  Attributes:
    name, cash, initial_cash, positions (dict), avg_cost (dict),
    portfolio_value_history (list),
    last_action (str)       â€“ "BUY" / "SELL" / "HOLD"
    last_reasoning (str)    â€“ human-readable explanation of last decision
    last_reason (str)       â€“ backward-compat alias for last_reasoning
    goal (str)              â€“ strategic objective (set by subclasses)
    _state, halted, active, _peak_value
    memory (list[dict])     â€“ full perceiveâ†’reasonâ†’act history per step
    performance_stats (dict) â€“ {pnl, wins, losses, max_drawdown}

  Agentic Pipeline Methods:

    perceive(market_state) â†’ dict                             â˜… Agentic Pipeline
      Extracts relevant features from raw market state.
      Default impl returns market_state as-is.
      Subclasses override to extract agent-specific features
      (e.g. SMA values for Momentum, Bollinger Bands for MeanReversion).

    reason(observation) â†’ dict                                â˜… Agentic Pipeline
      Rule-based decision from the observation.
      Returns: {"action": "BUY"|"SELL"|"HOLD",
                "quantity": int,
                "reasoning": str}
      Subclasses override with strategy-specific logic.

    act(decision) â†’ dict                                      â˜… Agentic Pipeline
      Converts internal decision to action dict.
      Sets self.last_action and self.last_reasoning.
      Returns: {"action": ..., "quantity": ..., "reasoning": ...}

    step(market_state) â†’ dict                                 â˜… Composite Method
      Runs the full pipeline: perceive â†’ reason â†’ act.
      Appends the full {observation, decision, action} record to memory.
      This is what the Orchestrator calls each simulation step.

  Other Methods:

    explain_last_action() â†’ str
      Returns self.last_reasoning.

    build_reasoning(**kwargs) â†’ str
      Utility to build concise reasoning strings from key indicators.

    update_after_step(reward, state) â†’ None
      Adaptation hook â€” now tracks performance_stats:
      updates pnl, wins/losses count, max_drawdown, and
      stamps the last memory entry with the result.

    get_portfolio_value(price, ticker) â†’ float
      Cash + holdings value at given price.

    execute_action(action, price) â†’ None
      Apply BUY/SELL to cash/positions.  Supports both "action" and
      legacy "type" keys.  Updates last_action, last_reasoning, last_reason.

    get_risk_metrics(price, ticker) â†’ dict
      return_pct, max_drawdown_pct, sharpe_ratio, current_drawdown_pct

    to_dict(price, ticker) â†’ dict
      Serialize for frontend.  Includes: name, cash, positions,
      portfolio_value, last_action, last_reasoning, last_reason,
      goal, status, halted, active, return_pct, max_drawdown_pct,
      sharpe_ratio, memory_size, latest_memory, performance_stats.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.6  Conservative Agent (agents/conservative_agent.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: ConservativeAgent(TradingAgent)

  Goal: Preserve capital with small, steady returns in calm markets.

  Configurable Parameters (via params dict):
    VOLATILITY_THRESHOLD   â€“ max volatility to trade (default 0.02)
    POSITION_FRACTION      â€“ % of cash per trade (default 7%)
    STOP_LOSS_PCT          â€“ stop-loss threshold (default 3%)

  Agentic Pipeline:
    perceive(market_state):
      Extracts: ticker, close, sma20, sma50, volatility, held_qty, avg_cost

    reason(observation):
      Decision Logic:
        1. Stop-loss: if holding & price < avg_cost Ã— (1 âˆ’ 3%) â†’ SELL all
        2. Volatility filter: if vol > 0.02 â†’ HOLD
        3. Entry: if price < SMA50 AND SMA20 > SMA50 AND no position â†’ BUY small
        4. Default: HOLD

  Produces detailed reasoning for every decision.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.7  Momentum Agent (agents/momentum_agent.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: MomentumAgent(TradingAgent)

  Goal: Maximise profit by riding established price trends.

  Configurable Parameters (via params dict):
    POSITION_FRACTION â€“ % of cash per trade (default 15%)

  Agentic Pipeline:
    perceive(market_state):
      Extracts: ticker, close, sma20, sma50, held_qty

    reason(observation):
      Decision Logic:
        1. Golden cross: SMA20 > SMA50 & no position â†’ BUY
        2. Death cross:  SMA20 < SMA50 & holding â†’ SELL all
        3. Default: HOLD (riding trend or no signal)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.8  Mean-Reversion Agent (agents/mean_reversion_agent.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: MeanReversionAgent(TradingAgent)

  Goal: Profit from price reversion to the moving average after extremes.

  Configurable Parameters (via params dict):
    POSITION_FRACTION â€“ % of cash per trade (default 12%)
    BAND_MULTIPLIER   â€“ Bollinger Band width multiplier (default 2.0)

  Agentic Pipeline:
    perceive(market_state):
      Extracts: ticker, close, bb_mid; recomputes bb_up/bb_low with
      configurable BAND_MULTIPLIER

    reason(observation):
      Decision Logic:
        1. Oversold: price < BB_LOW â†’ BUY
        2. Overbought: price > BB_UP & holding â†’ SELL all
        3. Default: HOLD (within normal bands)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.9  Noise Trader (agents/noise_trader.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: NoiseTrader(TradingAgent)

  Goal: Inject realistic irrational / retail-style trading activity.

  Configurable Parameters (via params dict):
    TRADE_PROBABILITY â€“ chance to trade each step (default 15%)
    POSITION_FRACTION â€“ % of cash per trade (default 2%)

  Agentic Pipeline:
    perceive(market_state):
      Extracts: ticker, close, held_qty; generates trade_roll and
      direction_roll random values

    reason(observation):
      Decision Logic:
        1. Each step: 15% chance to trade, 85% HOLD
        2. If trading: 50/50 BUY random qty or SELL random portion of holdings
        3. Very small position sizes to simulate noise


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.10  Adversarial Agent (agents/adversarial_agent.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: AdversarialAgent(TradingAgent)

  Goal: Simulate pump-and-dump manipulation to stress-test the Regulator.

  Configurable Parameters (via params dict):
    PUMP_FRACTION      â€“ % of cash for pump trades (default 25%)
    DUMP_THRESHOLD     â€“ gain % to trigger dump (default 3%)
    VOLUME_LOW_PCTILE  â€“ volume percentile for low-vol detection (default 30%)
    PUMP_PROBABILITY   â€“ random chance to pump (default 20%)

  Internal State:
    _volume_history â€“ tracks volume for percentile analysis
    _phase          â€“ "idle" / "pump" / "dump"

  Agentic Pipeline:
    perceive(market_state):
      Extracts: ticker, close, volume, held_qty, avg_cost;
      appends volume to _volume_history for percentile analysis

    reason(observation):
      Decision Logic:
        1. Dump phase: if holding & unrealised gain â‰¥ 3% â†’ SELL all
        2. Pump phase: if current volume in bottom 30% & random trigger â†’ BUY large
        3. Default: HOLD (idle)

  Labels all trades as "PUMP phase" or "DUMP phase" in reasoning.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.11  Regulator Agent (regulator/regulator.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: RegulatorAgent

  Goal: Maintain market integrity by reviewing every proposed trade.

  Constants:
    MAX_POSITION_PCT       = 0.30   (max 30% portfolio in one ticker)
    MAX_ORDER_VOLUME_PCT   = 0.10   (max 10% of avg volume per trade)
    BURST_WINDOW           = 5      (look-back steps for burst detection)
    BURST_THRESHOLD        = 3      (max large orders before BLOCK)
    CRASH_DROP_PCT         = âˆ’0.05  (>5% price drop = crash condition)
    CRASH_LOOKBACK         = 10     (bars averaged for crash baseline)
    WARN_ESCALATION_THRESHOLD = 5   (cumulative warnings before BLOCK)  â˜… Phase 2
    WARN_COOLDOWN_STEPS    = 10     (steps agent stays blocked after    â˜… Phase 2
                                     escalation; resets after cooldown)

  Internal State:
    _recent_orders      â€“ per-agent list of steps with large orders
    _warning_counts     â€“ per-agent cumulative warning counter          â˜… Phase 2
    _escalation_blocked â€“ per-agent step when escalation block began    â˜… Phase 2

  Method: review_trade(agent_name, action, agent_state, market_state, step)
    Accepts both new ("action"/"reasoning") and legacy ("type") key names.
    Returns: {decision, reason, adjusted_action, count_at_step}

    Rules Enforced:
      1. MaxPositionLimit   â€“ BUY exceeds 30% allocation â†’ WARN + reduce qty
      2. MaxOrderSize       â€“ order > 10% of volume â†’ WARN + reduce qty
      3. ManipulationPattern / BurstTrading â€“ â‰¥3 large orders in 5 steps â†’ BLOCK
      4. AdversarialFlag    â€“ large orders from adversarial agents â†’ WARN
      5. ContrarianCrashDetection â€“ agent tries to BUY while market is
         crashing (simulated price >5% below recent average) â†’ WARN
         with message: "Market is down âˆ’X.X%, agent chose BUY.
         Risky contrarian behaviour: {agent's reasoning}"
      6. RepeatOffender     â€“ agent accumulates â‰¥5 cumulative warnings  â˜… Phase 2
         â†’ BLOCK + 10-step cooldown.  During cooldown all trades from
         that agent are immediately BLOCKED.  Warning count resets
         after cooldown expires.

    HOLD actions always get APPROVE.
    Rule 0 (escalation check) runs first â€” if an agent is in cooldown,
    the trade is immediately BLOCKED without evaluating other rules.

  Helper: _compute_crash_drop(market_state) â†’ float
    Computes percentage drop between current simulated price and the
    average of the last CRASH_LOOKBACK simulated prices.  Returns a
    negative float (e.g. âˆ’0.07 for 7% drop).  Returns 0.0 if
    insufficient history.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.12  Simulation Logger (logging_utils/logger.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: SimulationLogger

  Dual-write strategy:
    1. In-memory lists   â†’ served to React frontend via REST API
    2. SQLite database   â†’ persistent storage for post-hoc analysis

  Methods:
    __init__()                                    â€“ empty lists, no DB yet
    set_db(db, run_id, ticker)                    â€“ attach DB for dual-write
    reset()                                       â€“ clear in-memory logs
    log_trade(step, agent_name, action, price,    â€“ write to list + trades table
              quantity, portfolio_value, reason,
              decision, decision_reason)
    log_regulation_event(step, agent_name,        â€“ write to list + regulation_events
                         rule_name, decision,
                         explanation)
    get_trade_log() â†’ list[dict]                  â€“ return trades list copy
    get_regulation_log() â†’ list[dict]             â€“ return regulation list copy

  Note: During jump_to_step replay, the orchestrator temporarily sets
  logger._db = None to prevent SQLite writes, restoring it afterwards.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.13  SQLite Database Layer (db.py)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Class: SimulationDB

  Purpose: Persistent storage for post-hoc analysis (DevHack 2026 requirement).

  DB file: devhack.db (auto-created next to db.py)
  Journal mode: WAL (write-ahead logging for performance)
  Thread safety: check_same_thread=False (Flask threading)

  Tables (auto-created on startup):

    runs:
      run_id TEXT PRIMARY KEY    â€“ UUID per simulation run
      ticker TEXT                â€“ e.g. "AAPL"
      period TEXT                â€“ e.g. "5d"
      interval TEXT              â€“ e.g. "5m"
      started_at TEXT            â€“ ISO timestamp

    trades:
      trade_id INTEGER PK AUTOINCREMENT
      run_id TEXT                â€“ FK to runs
      step INTEGER               â€“ simulation step
      ticker TEXT                â€“ ticker symbol
      agent TEXT                 â€“ agent name
      action TEXT                â€“ BUY / SELL / HOLD
      price REAL                 â€“ market price
      quantity INTEGER           â€“ shares
      portfolio_value REAL       â€“ agent portfolio after trade
      decision TEXT              â€“ APPROVE / WARN / BLOCK
      decision_reason TEXT       â€“ regulator explanation
      ts TEXT                    â€“ ISO timestamp

    regulation_events:
      id INTEGER PK AUTOINCREMENT
      run_id TEXT                â€“ FK to runs
      step INTEGER               â€“ simulation step
      agent TEXT                 â€“ agent involved
      rule TEXT                  â€“ rule name triggered
      decision TEXT              â€“ WARN / BLOCK
      explanation TEXT           â€“ detailed explanation
      ts TEXT                    â€“ ISO timestamp

  Methods:
    create_run(run_id, ticker, period, interval)
    insert_trade(run_id, step, ticker, agent, action, price, qty, pv, decision, reason)
      Uses _safe_commit() for resilient transaction handling.
    insert_regulation_event(run_id, step, agent, rule, decision, explanation)
      Uses _safe_commit() for resilient transaction handling.
    _safe_commit()                                            â˜… Phase 2 NEW
      Commits only if conn.in_transaction is True. Prevents
      "cannot commit - no transaction is active" errors during
      rapid sequential inserts (esp. during jump replay).
    close()

  All write operations are wrapped in try/except to prevent DB errors from
  crashing the simulation.


================================================================================
6. FRONTEND â€” DETAILED BREAKDOWN
================================================================================


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.1  Entry Point & App Shell
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  main.jsx   â€“ renders <App /> inside <React.StrictMode> into #root
  index.html â€“ HTML5 shell with <div id="root">, loads /src/main.jsx as ESM
               Title: "Multi-Agent Stock Market AI"

  App.jsx â€“ Root component managing all application state:

    Constants:
      ALL_AGENTS     â€“ array of {key, label} for 5 agent types
      DEFAULT_PARAMS â€“ per-agent default parameter objects:
        conservative:  {risk_pct: 0.07, stop_loss_pct: 0.03, volatility_threshold: 0.02}
        momentum:      {position_size_pct: 0.15}
        meanreversion: {position_size_pct: 0.12, band_multiplier: 2.0}
        noisetrader:   {trade_probability: 0.15, position_size_pct: 0.02}
        adversarial:   {pump_fraction: 0.25, dump_threshold: 0.03,
                        volume_low_pctile: 0.30, pump_probability: 0.20}

    State Variables:
      ticker, period, interval_         â€“ simulation parameters
      activeAgents                      â€“ array of enabled agent keys
      agentParams                       â€“ per-agent param overrides
      showSettings                      â€“ modal visibility
      speedMs (300)                     â€“ auto-run interval in ms
      batchSize (1)                     â€“ steps per auto-run tick
      snapshot                          â€“ latest API response
      error                             â€“ error message string
      status                            â€“ 'idle' / 'paused' / 'running' / 'finished'
      crashFlash                        â€“ red flash animation trigger
      highlightStep                     â€“ step highlighted on chart
      theme                             â€“ 'dark' / 'light' (persisted to localStorage)
      activeTab                         â€“ 'trades' / 'market' / 'agents' / 'stats' / 'help'
      maxReachedStep                    â€“ highest step reached (caps scrubber)
      jumpingRef (useRef)               â€“ prevents concurrent jump API calls

    Derived Values:
      totalBalance                      â€“ sum of all agents' portfolio_value

    Event Handlers:
      handleInit()      â€“ call /api/init; resets maxReachedStep to 0
      handleStep()      â€“ call /api/step?n=batchSize; updates maxReachedStep
      handleAutoRun()   â€“ start setInterval loop; updates maxReachedStep
      handlePause()     â€“ clear interval
      handleJump(step)  â€“ call /api/jump; blocks if step > maxReachedStep;
                          uses jumpingRef lock to prevent concurrent jumps
      handleCrash()     â€“ call /api/trigger-crash + 1.2s red flash
      toggleAgent(key)  â€“ enable/disable agent
      setTheme()        â€“ toggle dark/light, persist to localStorage

    Layout (3-column):
      TopBar (sticky, full width)
      Error banner (conditional)
      olymp-layout grid:
        Column 1 (72px): LeftSidebar (tab navigation)
        Column 2 (1fr):  Content area (switches by activeTab):
          â€¢ trades â†’ PriceChart + TradeLogTable + RegulationLogTable
          â€¢ market â†’ PriceChart + MarketPanel
          â€¢ agents â†’ AgentsPanel
          â€¢ stats  â†’ RiskOverviewPanel + StatsPanel + PerformanceCharts
          â€¢ help   â†’ HelpPanel
        Column 3 (310px): RightTradePanel (controls)
      SettingsModal (conditional overlay)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.2  API Client (api/client.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Base URL: http://localhost:5000
  Timeout: 60 seconds (120 seconds for jump endpoint)

  Functions:
    initSimulation(ticker, period, interval, activeAgents?, agentParams?)
      â†’ POST /api/init

    stepSimulation(n=1)
      â†’ POST /api/step?n=N

    autoStepSimulation(steps=10)
      â†’ POST /api/auto-step  body: {steps}

    jumpToStep(step)
      â†’ POST /api/jump  body: {step}  timeout: 120s

    triggerCrash()
      â†’ POST /api/trigger-crash

    getState()
      â†’ GET /api/state


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.3  TopBar (components/TopBar.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Sticky header bar (56px height) with glassmorphism backdrop blur.

  Features:
    â€¢ Logo "â—ˆ MASTER" with gradient text
    â€¢ Stock ticker dropdown (AAPL, MSFT, TSLA, NSEI, RELIANCE.NS, TCS.NS, INFY.NS)
    â€¢ Period dropdown selector
    â€¢ Center title: "Multi Agent Stock Market Environment For Research V1"
    â€¢ Portfolio balance display in â‚¹ with gradient green text
    â€¢ Crash indicator badge (animated pulse)
    â€¢ Theme toggle button (ğŸŒ™/â˜€ï¸) â€” dark/light cycle
    â€¢ Profile button (ğŸ‘¤)

  Fonts: JetBrains Mono for data, Space Grotesk for headings


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.4  LeftSidebar (components/LeftSidebar.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  72px-wide icon sidebar for tab navigation.  Sticky positioned below TopBar.

  Tab Items:
    â‡…  Trades     â€“ chart + trade log + regulation log
    â—  Market     â€“ chart + market overview
    â¬¡  Agents     â€“ agent cards with AI pipeline
    â—ˆ  Stats      â€“ risk overview + statistics + performance charts
    ?  Help       â€“ in-app documentation

  Visual:
    â€¢ Active tab: cyan highlight + left accent bar (3px-wide absolute)
    â€¢ Footer: green pulsing "Live" indicator dot

  Props: activeTab, onTabChange


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.5  RightTradePanel (components/RightTradePanel.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  310px-wide right-side controls panel.

  Sections:
    Candle Interval Selector: 1m, 5m, 15m, 1h, 1d
    Speed Slider: 50ms â€“ 1000ms (auto-run interval) with cyan accent
    Batch Size Slider: 1 â€“ 20 (steps per tick)
    Agent Toggle Checkboxes: enable/disable each of 5 agents
    Action Buttons (2Ã—2 grid):
      â€¢ â–¶ Initialize  (blue)
      â€¢ â© Step        (cyan)
      â€¢ â–¶ Run         (green)
      â€¢ â¸ Pause       (amber)
    Crash Trigger Button: animated pulse when crash is active
    Agent Settings Button: opens SettingsModal
    Status Info Panel: STATUS badge + "Step X / Y" counter


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.6  PriceChart (components/PriceChart.jsx â€” TradingView Lightweight Charts v5)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Professional-grade candlestick chart powered by TradingView Lightweight
  Charts v5 (NOT Recharts).

  Chart Features:
    â€¢ Toggle between Candlestick and Line chart modes
    â€¢ OHLC candlesticks (green up / red down)
    â€¢ Close price line (cyan #00d4ff)
    â€¢ SMA20 overlay line (orange #ffb800)
    â€¢ SMA50 overlay line (purple #a855f7)
    â€¢ Bollinger Band upper line (gray dashed)
    â€¢ Bollinger Band lower line (gray dashed)
    â€¢ Bollinger Band mid line (gray dotted)
    â€¢ Trade markers via createSeriesMarkers API:
        â–² arrowUp (green) for BUY trades
        â–¼ arrowDown (red) for SELL trades
    â€¢ Full crosshair with dashed cyan lines and custom label background
    â€¢ Floating legend overlay â€” live OHLC + indicator values on crosshair hover
    â€¢ ResizeObserver for responsive chart sizing
    â€¢ Transparent background (inherits dark card)

  Neon Color Palette:
    Up candles:   #00ff88 (green)
    Down candles:  #ff3b5c (red)
    Line/crosshair: #00d4ff (cyan)
    SMA50:        #ffb800 (amber)
    BB lines:     #a855f7 (purple)

  Additional UI:
    â€¢ Latest trade notification bar below chart: agent, action, qty, price (â‚¹)
    â€¢ Step scrubber slider at bottom:
        - Debounced: uses local scrubValue state during drag
        - Fires onJump only on onMouseUp / onTouchEnd (not onChange)
        - Max limited to maxReachedStep prop
        - Prevents jumping beyond computed steps

  Props: snapshot, onJump, maxReachedStep


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.7  MarketPanel (components/MarketPanel.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Detailed market data view displayed in the "Market" tab.

  Sections:
    â€¢ Big price display with directional arrow and % change (â‚¹)
    â€¢ Session range bar: lowâ€“high with positioned dot for current close
    â€¢ OHLC grid: 4-column layout (Open, High, Low, Close) in â‚¹
    â€¢ Technical indicators grid: SMA20, SMA50, BB Upper, BB Lower, BB Mid,
      Simulated Price â€” all in â‚¹
    â€¢ SMA crossover signal badge:
        "â–² BULLISH Golden Cross" (green) when SMA20 > SMA50
        "â–¼ BEARISH Death Cross" (red) when SMA20 < SMA50
    â€¢ Volatility & Volume section:
        Current volatility, average volatility, average volume, total bars
        Volatility meter bar (gradient green â†’ amber â†’ red, 5% max scale)
    â€¢ Crash Active badge when crash is in effect


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.8  AgentsPanel (components/AgentsPanel.jsx â€” 687 lines)              â˜… Phase 2
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Rich, interactive agent display panel with expandable sections.
  Now shows ALL 7 agents â€” system agents + trading agents.            â˜… Phase 2

  Props: agents, tradeLog, headAgent, regulatorAgent, systemRisk      â˜… Phase 2

  Summary Bar:
    Header shows "â¬¡ AI Agents" with "7 agents Â· N total trades" badge.
    Horizontal scrollable quick-select buttons for 5 trading agents
    with icon, name, and return % â€” click to expand agent card below.

  System Agent Cards (side-by-side grid):                              â˜… Phase 2
    1. Orchestrator Card (ğŸ§  cyan accent):
       â€¢ Status badge (ACTIVE / HALTED)
       â€¢ Step progress (current/max)
       â€¢ Run ID (truncated)
       â€¢ Crash status (YES/NO)
       â€¢ Circuit breakers active count
       â€¢ Total AUM from systemRisk
    2. Regulator Card (âš– amber accent):
       â€¢ Status badge (ACTIVE / HALTED)
       â€¢ Approved / Warned / Blocked counters (color-coded)
       â€¢ Compliance rate bar (green=approvals, amber=warnings)
       â€¢ Rules enforced as tag chips (6 rules)

  Trading Agent Metadata:
    Each of 5 agents has: icon emoji (ğŸ›¡ ğŸš€ â†© ğŸ² ğŸ¦ˆ), accent color,
    strategy description, style label (Defensive/Aggressive/Contrarian/
    Random/Manipulative)

  Trading Agent Card Features:
    â€¢ Portfolio value (â‚¹) with allocation progress bar
    â€¢ Cash / holdings breakdown
    â€¢ SparkBar: custom SVG mini bar chart of portfolio history
    â€¢ Risk metric chips (flex-wrap, color-coded):
        Return % (green/red), Drawdown %, Max DD %, Sharpe Ratio
    â€¢ Last action badge: â–² BUY (green) / â–¼ SELL (red) / HOLD (muted)
    â€¢ Reasoning box: purple-bordered box with ğŸ’­ emoji prefix
    â€¢ Memory buffer size indicator

  Expandable Sections:
    1. Trade History: scrollable table per agent
       (Step, Side, Qty, Price â‚¹, Value â‚¹, Status)
    2. AI Pipeline View: 4-step visualization
       â‘  Perceive â†’ â‘¡ Reason â†’ â‘¢ Act â†’ â‘£ Result
       With colored labels and content from agent.latest_memory

  Visual States:
    â€¢ Halted agents: red accent
    â€¢ Inactive agents: dimmed opacity


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.9  StatsPanel (components/StatsPanel.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Simulation statistics dashboard displayed in the "Stats" tab.

  Sections:
    â€¢ Simulation Summary: Total AUM (â‚¹), Cash Reserves (â‚¹), Active Agents
    â€¢ Trading Activity: Total Trades, Buys, Sells, Blocked, buy/sell ratio bar
    â€¢ Agent Leaderboard: sorted by return %, medal emojis (ğŸ¥‡ğŸ¥ˆğŸ¥‰),
      portfolio value in â‚¹
    â€¢ Risk Metrics: Avg Return %, Avg Sharpe, Max Drawdown %,
      Total Violations, Best/Worst Agent names

  Uses useMemo for computed stats. Pure inline styles.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.10  HelpPanel (components/HelpPanel.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  In-app documentation and help page displayed in the "Help" tab.

  Sections:
    â€¢ Hero card with gradient title â€” "7 autonomous AI agents"        â˜… Phase 2
    â€¢ System agents section: Orchestrator (ğŸ§ ) + Regulator (âš–)        â˜… Phase 2
      with sub-header "System Agents"
    â€¢ Trading agents section: 5 AI agent descriptions with colored
      accent cards, sub-header "Trading Agents"
      (Conservative, Momentum, MeanReversion, NoiseTrader, Adversarial)
    â€¢ AI Pipeline visualization: Perceive â†’ Reason â†’ Act â†’ Regulate
      with step descriptions (Regulate mentions escalation/cooldown)   â˜… Phase 2
    â€¢ Controls guide: what each button does (â‚¹1,00,000 starting)
    â€¢ Navigation tabs guide: Agents tab mentions all 7 agents          â˜… Phase 2
    â€¢ Tech stack grid: TradingView v5, React 18, Flask, Recharts, etc.

  Internal helper components: PipelineStep, AgentRow, Key


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.11  RiskOverviewPanel (components/RiskOverviewPanel.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  System-wide risk dashboard.

  Risk Level Assessment:
    HIGH   (red)    â€“ global drawdown â‰¤ âˆ’10% or exposure > 80%
    MEDIUM (yellow) â€“ global drawdown â‰¤ âˆ’5% or exposure > 50%
    LOW    (green)  â€“ otherwise

  Metric Cards:
    â€¢ Total AUM (â‚¹)
    â€¢ Exposure %
    â€¢ Global Drawdown %
    â€¢ Open Positions Count
    â€¢ Total Violations Count
    â€¢ Circuit Breakers Active

  Special States:
    â€¢ "âš  CRASH ACTIVE" badge when crash is in effect
    â€¢ Red border glow during crash


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.12  PerformanceCharts (components/PerformanceCharts.jsx â€” Recharts)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Two side-by-side charts (uses Recharts library):

  1. Portfolio Performance (LineChart)
     - One line per agent (neon colors: #00d4ff, #00ff88, #ffb800, #a855f7, #ff3b5c)
     - Shows portfolio value over time
     - Data reconstructed from trade log
     - Neon-styled tooltips (dark glass bg, cyan border, JetBrains Mono)

  2. Regulatory Violations (BarChart)
     - Bar per agent (same neon color palette)
     - Counts WARN + BLOCK events from regulation log


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.13  TradeLogTable (components/TradeLogTable.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Scrollable, filterable trade log.

  Features:
    â€¢ Agent filter dropdown (ALL or specific agent)
    â€¢ Shows last 100 entries (newest first)
    â€¢ Columns: Step, Agent, Action, Price (â‚¹), Qty, Portfolio (â‚¹),
               Reason (truncated 60 chars), Decision (color-coded),
               Regulator Reason (truncated 50 chars)
    â€¢ Decision color coding:
        APPROVE â†’ green
        WARN    â†’ yellow
        BLOCK   â†’ red


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.14  RegulationLogTable (components/RegulationLogTable.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Scrollable regulation event log.

  Features:
    â€¢ Shows last 80 entries (newest first)
    â€¢ Columns: Step, Agent, Rule, Decision (color-coded), Explanation
    â€¢ Explanation truncated to 80 chars with full text in tooltip
    â€¢ Decision color coding: WARN (yellow), BLOCK (red)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.15  SettingsModal (components/SettingsModal.jsx)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Modal overlay for per-agent parameter tuning.

  Features:
    â€¢ Backdrop blur overlay
    â€¢ Grid of agent settings cards
    â€¢ Number inputs for each configurable parameter:
        Conservative: Risk %, Stop Loss %, Volatility Threshold
        Momentum:     Position Size %
        MeanReversion: Position Size %, Band Multiplier
        NoiseTrader:  Trade Probability, Position Size %
        Adversarial:  Pump Fraction, Dump Threshold, Volume Percentile,
                      Pump Probability
    â€¢ "Reset Defaults" button
    â€¢ "Apply & Close" button
    â€¢ Click overlay to close


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6.16  CSS / Theming (index.css â€” 1066 lines)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Theme: Dual-theme support (dark + light) via body class toggling
    Dark:  #07080d background, neon terminal aesthetic
    Light: white backgrounds, reduced glows, adjusted palette

  Persistence: theme saved to localStorage

  CSS Variables: 58 custom properties in :root covering colors, glows,
    gradients, border-radius, transitions

  Font Stack:
    Space Grotesk (headings), Inter (body), JetBrains Mono (data/mono)

  Layout:
    â€¢ 3-column grid (.olymp-layout: 72px + 1fr + 310px)
    â€¢ Full width, no max-width constraint
    â€¢ TopBar: sticky, 56px, glassmorphism (backdrop-filter: blur + saturate)

  Card Styling:
    Glassmorphism: rgba(14,17,28,0.75) + backdrop-filter: blur(12px) saturate(1.3)

  Scrollbar: Custom thin WebKit scrollbar (6px, translucent)

  Animations:
    â€¢ crash-bg-flash (red pulse on crash trigger)
    â€¢ fadeIn (staggered agent/risk cards)
    â€¢ pulse (live indicator dot)
    â€¢ status-glow (running badge)
    â€¢ crash-pulse (crash button)

  Responsive Breakpoints:
    â€¢ 1400px: narrower right panel
    â€¢ 1024px: single column, sidebar hidden, right panel adjusts
    â€¢ 640px: compact TopBar

  Light Theme (.theme-light):
    Full override of all CSS variables â€” white/light backgrounds,
    reduced neon glows, adjusted text colors


================================================================================
7. ALL FEATURES LIST
================================================================================

  Core Simulation:
    [1]  Real market data via yfinance (any ticker, period, interval)
    [2]  5 autonomous trading agents with distinct strategies
    [3]  Regulator / compliance agent reviewing every trade (6 rules)
    [4]  OrchestratorAgent (Head Agent) coordinating entire system
    [5]  Step-by-step simulation with full state tracking
    [6]  Endogenous price impact model (agent order flow moves price)

  Agentic AI Pipeline:                                        â˜… Phase 2 NEW
    [7]  Perceive â†’ Reason â†’ Act pipeline for every agent
    [8]  Per-agent memory buffer storing full pipeline history
    [9]  Performance stats tracking (pnl, wins, losses, max_drawdown)
    [10] AI Pipeline visualization in AgentsPanel (4-step view)
    [11] Memory size indicator per agent

  Agent Features:
    [12] Structured decision dicts: {action, quantity, reasoning}
    [13] Per-agent goal attribute (strategic objective)
    [14] build_reasoning() helper for concise indicator summaries
    [15] Per-agent configurable parameters (via Settings Modal)
    [16] Agent enable/disable toggles (runtime)
    [17] Individual portfolio tracking (â‚¹1,00,000 initial per agent)
    [18] Per-agent risk metrics (return %, drawdown, Sharpe ratio)
    [19] Human-readable reasoning strings for every decision
    [20] Per-agent circuit breakers (auto-halt at >10% drawdown)

  Market Features:
    [21] Technical indicators: SMA20, SMA50, Bollinger Bands, Volatility
    [22] TradingView Lightweight Charts v5 candlestick chart             â˜… Phase 2
    [23] Toggle between Candlestick and Line chart modes
    [24] Trade markers on chart (â–² BUY / â–¼ SELL via TradingView markers)
    [25] Floating legend overlay with live OHLC + indicator values
    [26] Step scrubber with debounced drag (fire on release only)         â˜… Phase 2
    [27] Max reached step enforcement (can't jump past computed steps)    â˜… Phase 2
    [28] Fast rewind without re-downloading data                          â˜… Phase 2

  Whale Manipulation / Cascade Crash:
    [29] Trigger Crash button â†’ whale dumps 100% of holdings
    [30] 15-20% OHLC price drop + indicator recalculation
    [31] Endogenous price impact amplifies the crash
    [32] Momentum / other agents react naturally (stop-loss, trend reversal)
    [33] Global circuit breaker halts ALL trading at âˆ’15% system drawdown
    [34] trading_status: "HALTED_BY_CIRCUIT_BREAKER" exposed to frontend

  Risk & Compliance:
    [35] System-wide risk dashboard (AUM, exposure, drawdown, violations)
    [36] Risk level assessment (LOW / MEDIUM / HIGH)
    [37] Violation heatmap (per-agent violation bar chart)
    [38] 6 compliance rules:                                         â˜… Phase 2
           MaxPositionLimit, MaxOrderSize, BurstTrading,
           AdversarialFlag, ContrarianCrashDetection,
           RepeatOffender (warnings â†’ block escalation)
    [39] Regulator reads agent reasoning to flag contrarian crash trades
    [39b] Repeat-offender escalation: â‰¥5 warnings â†’ BLOCK +             â˜… Phase 2
           10-step cooldown; warning count resets after cooldown

  UI / UX:                                                    â˜… Phase 2 NEW
    [40] 3-column layout: icon sidebar + center + controls panel
    [41] 5-tab navigation: Trades Â· Market Â· Agents Â· Stats Â· Help
    [42] TopBar with stock selector, portfolio balance (â‚¹), crash badge
    [43] Dark + Light theme toggle (persisted to localStorage)
    [44] Neon terminal aesthetic (glassmorphism, backdrop blur, CSS vars)
    [45] Fonts: Space Grotesk + Inter + JetBrains Mono
    [46] MarketPanel: OHLC, indicators, SMA crossover signal, volatility meter
    [47] StatsPanel: AUM, leaderboard, risk metrics, trading activity
    [48] HelpPanel: 7 agent docs (system+trading), AI pipeline, controls, tech stack
    [49] AgentsPanel: Orchestrator + Regulator system cards at top,         â˜… Phase 2
         5 trading agent rich cards with SparkBar, risk chips, expandable
         trade history + AI pipeline visualization
    [50] Auto-run with configurable speed slider (50ms â€“ 1000ms)
    [51] Batch step size control (1 â€“ 20 steps per tick)
    [52] Filterable trade log table (by agent)
    [53] Regulation event log table
    [54] Portfolio performance line chart per agent (Recharts, neon colors)
    [55] Crash flash animation (red pulse effect)
    [56] Status badges (idle / running / paused / finished / halted)
    [57] Latest trade notification bar below chart
    [58] Responsive design (3 breakpoints: 1400px, 1024px, 640px)
    [59] Currency in â‚¹ (INR) throughout

  Data & Storage:
    [60] SQLite persistent database (devhack.db)
    [61] Dual-write logging (in-memory + SQLite)
    [62] Per-run UUID tracking
    [63] Full audit trail (every trade + regulation event stored)
    [64] Safe commit handling (_safe_commit) for resilient DB writes       â˜… Phase 2

  Architecture:
    [65] Head Agent / Orchestrator pattern
    [66] Facade pattern (Simulation wraps Orchestrator)
    [67] Agentic pipeline abstraction (Perceive â†’ Reason â†’ Act)           â˜… Phase 2
    [68] Clean agent abstraction (base class + 5 implementations)
    [69] REST API with 6 endpoints
    [70] Proxy-based dev setup (Vite â†’ Flask)


================================================================================
8. REST API REFERENCE
================================================================================

  Base URL: http://localhost:5000

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Endpoint             â”‚ Method â”‚ Description                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ /api/init            â”‚ POST   â”‚ Initialize simulation                 â”‚
  â”‚                      â”‚        â”‚ Body: {ticker, period, interval,      â”‚
  â”‚                      â”‚        â”‚        active_agents?, agent_params?} â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ /api/step            â”‚ POST   â”‚ Advance 1 or N steps                  â”‚
  â”‚                      â”‚        â”‚ Query: ?n=5                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ /api/auto-step       â”‚ POST   â”‚ Batch run N steps (max 200)           â”‚
  â”‚                      â”‚        â”‚ Body: {steps: 10}                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ /api/jump            â”‚ POST   â”‚ Jump to specific step                 â”‚
  â”‚                      â”‚        â”‚ Body: {step: 42}                      â”‚
  â”‚                      â”‚        â”‚ (120s timeout, DB writes disabled     â”‚
  â”‚                      â”‚        â”‚  during replay for stability)         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ /api/trigger-crash   â”‚ POST   â”‚ Trigger market crash event            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ /api/state           â”‚ GET    â”‚ Get current simulation snapshot       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
9. DATABASE SCHEMA
================================================================================

  File: backend/devhack.db (SQLite, auto-created)

  TABLE: runs
    run_id      TEXT PRIMARY KEY        â† UUID per simulation
    ticker      TEXT                    â† e.g. "AAPL"
    period      TEXT                    â† e.g. "5d"
    interval    TEXT                    â† e.g. "5m"
    started_at  TEXT                    â† ISO timestamp

  TABLE: trades
    trade_id        INTEGER PK AUTO     â† sequential ID
    run_id          TEXT                â† FK â†’ runs.run_id
    step            INTEGER             â† simulation step
    ticker          TEXT                â† ticker symbol
    agent           TEXT                â† agent name
    action          TEXT                â† BUY / SELL / HOLD
    price           REAL                â† market price
    quantity        INTEGER             â† number of shares
    portfolio_value REAL                â† portfolio value after trade
    decision        TEXT                â† APPROVE / WARN / BLOCK
    decision_reason TEXT                â† regulator explanation
    ts              TEXT                â† ISO timestamp

  TABLE: regulation_events
    id              INTEGER PK AUTO     â† sequential ID
    run_id          TEXT                â† FK â†’ runs.run_id
    step            INTEGER             â† simulation step
    agent           TEXT                â† agent involved
    rule            TEXT                â† rule name triggered
    decision        TEXT                â† WARN / BLOCK
    explanation     TEXT                â† detailed explanation
    ts              TEXT                â† ISO timestamp


================================================================================
10. AGENT INTERACTION FLOW
================================================================================

  For each simulation step, the Orchestrator executes:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  GUARD: trading_halted?   â”‚  â† If True â†’ force all HOLD, advance bar,
    â”‚  (global circuit breaker) â”‚    return "HALTED_BY_CIRCUIT_BREAKER"
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ not halted
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  1. Market.get_state()     â”‚  â† Get current bar (OHLCV + indicators)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  2. For each active agent: â”‚
    â”‚     action = agent.step()  â”‚  â† Runs Perceive â†’ Reason â†’ Act pipeline
    â”‚                            â”‚    Returns {action, quantity, reasoning}
    â”‚                            â”‚    + appends full record to agent.memory
    â”‚                            â”‚
    â”‚                            â”‚    â€¢ On crash-trigger step: whale's
    â”‚                            â”‚      pipeline is overridden â€” perceive()
    â”‚                            â”‚      runs, then act() called directly
    â”‚                            â”‚      with forced full-dump SELL
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  3. Regulator.review(      â”‚
    â”‚       agent, action,       â”‚  â† 5 compliance rules checked
    â”‚       agent_state,         â”‚  â† Reads action["reasoning"]
    â”‚       market_state)        â”‚  â† Returns APPROVE / WARN / BLOCK
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  4. If APPROVED or WARNED: â”‚
    â”‚     agent.execute_action() â”‚  â† Update cash / positions
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  5. Logger.log_trade()     â”‚  â† Write to memory + SQLite
    â”‚     Logger.log_regulation()â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  6. agent.update_after_step â”‚  â† Updates performance_stats:
    â”‚     (reward, new_state)     â”‚    pnl, wins/losses, max_drawdown
    â”‚                             â”‚    Stamps memory[-1] with result
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  7a. Per-agent circuit      â”‚  â† Halt agents with >10% drawdown
    â”‚      breakers               â”‚
    â”‚  7b. Global circuit breaker â”‚  â† If system drawdown â‰¤ âˆ’15%:
    â”‚      (trading_halted)       â”‚    ALL TRADING HALTED
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  8. Market.step(net_volume) â”‚  â† Advance bar + endogenous price impact
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Whale Manipulation / Cascade Crash Flow:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  User clicks "Trigger Crash" button             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Orchestrator.trigger_market_crash()             â”‚
    â”‚  1. Ensure whale has position (buy 90% if empty) â”‚
    â”‚  2. Drop OHLC 15-20%, recompute indicators       â”‚
    â”‚  3. Mark crash_mode_active = True                 â”‚
    â”‚  4. Run one step with whale's pipeline overridden â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Whale forced SELL â†’ big negative net_volume      â”‚
    â”‚  â†’ Endogenous price model pushes price further    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Subsequent ticks:                                â”‚
    â”‚  â€¢ Momentum sees downtrend â†’ stop-loss SELL       â”‚
    â”‚  â€¢ Conservative hits stop-loss â†’ SELL              â”‚
    â”‚  â€¢ Regulator flags contrarian BUYs as risky        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Global drawdown â‰¤ âˆ’15% â†’ trading_halted = True    â”‚
    â”‚  â†’ "HALTED_BY_CIRCUIT_BREAKER" status              â”‚
    â”‚  â†’ All further steps force HOLD for every agent    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
11. AGENTIC AI PIPELINE (Perceive â†’ Reason â†’ Act)
================================================================================

  Every trading agent implements a 3-step agentic pipeline, coordinated
  by the base TradingAgent.step() method:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    agent.step(market_state)                          â”‚
  â”‚                                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  â‘  PERCEIVE  â€” agent.perceive(market_state)                 â”‚    â”‚
  â”‚  â”‚     Extract relevant features from raw market state.         â”‚    â”‚
  â”‚  â”‚     Each agent extracts different features:                  â”‚    â”‚
  â”‚  â”‚       Conservative: close, SMA20/50, volatility, avg_cost   â”‚    â”‚
  â”‚  â”‚       Momentum:     close, SMA20/50                          â”‚    â”‚
  â”‚  â”‚       MeanReversion: close, BB_MID, recomputed BB_UP/LOW    â”‚    â”‚
  â”‚  â”‚       NoiseTrader:  close, random rolls                      â”‚    â”‚
  â”‚  â”‚       Adversarial:  close, volume, unrealised gain           â”‚    â”‚
  â”‚  â”‚     Returns: observation dict                                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                              â”‚                                       â”‚
  â”‚                              â–¼                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  â‘¡ REASON  â€” agent.reason(observation)                      â”‚    â”‚
  â”‚  â”‚     Apply strategy-specific decision logic.                  â”‚    â”‚
  â”‚  â”‚     Returns: {action, quantity, reasoning}                   â”‚    â”‚
  â”‚  â”‚                                                              â”‚    â”‚
  â”‚  â”‚     Conservative: volatility filter + stop-loss + SMA entry  â”‚    â”‚
  â”‚  â”‚     Momentum:     SMA20/50 golden/death cross               â”‚    â”‚
  â”‚  â”‚     MeanReversion: Bollinger Band mean reversion              â”‚    â”‚
  â”‚  â”‚     NoiseTrader:  random probability-based                   â”‚    â”‚
  â”‚  â”‚     Adversarial:  pump-and-dump phase machine                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                              â”‚                                       â”‚
  â”‚                              â–¼                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  â‘¢ ACT  â€” agent.act(decision)                               â”‚    â”‚
  â”‚  â”‚     Converts internal decision to action dict.               â”‚    â”‚
  â”‚  â”‚     Sets last_action, last_reasoning.                        â”‚    â”‚
  â”‚  â”‚     Returns: {action, quantity, reasoning}                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                              â”‚                                       â”‚
  â”‚                              â–¼                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Memory: append {observation, decision, action} to memory   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                                      â”‚
  â”‚  After execution, Orchestrator sends trade to Regulator:             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  â‘£ REGULATE  â€” regulator.review_trade(...)                  â”‚    â”‚
  â”‚  â”‚     5 compliance rules â†’ APPROVE / WARN / BLOCK             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                                      â”‚
  â”‚  After step completion:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  â‘¤ UPDATE  â€” agent.update_after_step(reward, state)         â”‚    â”‚
  â”‚  â”‚     Updates performance_stats (pnl, wins, losses, drawdown) â”‚    â”‚
  â”‚  â”‚     Stamps memory[-1]["result"] with outcome                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
12. DEVHACK 2026 PHASE-2 COMPLIANCE
================================================================================

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Requirement                     â”‚ How Satisfied                          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Minimum 2 agents demonstrated   â”‚ 5 trading agents + 1 Regulator = 6    â”‚
  â”‚ (from PPT)                      â”‚ + OrchestratorAgent as Head Agent      â”‚
  â”‚                                 â”‚ = 7 total agents                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Core agents highlighted (5+     â”‚ OrchestratorAgent (Head Agent) and     â”‚
  â”‚ agents â†’ 2 core agents)         â”‚ RegulatorAgent as the 2 core agents   â”‚
  â”‚                                 â”‚ 5 trading agents as supporting agents  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 1 Head Agent (Orchestrator)     â”‚ OrchestratorAgent class in             â”‚
  â”‚                                 â”‚ simulation/orchestrator.py             â”‚
  â”‚                                 â”‚ Owns clock, coordinates all agents,    â”‚
  â”‚                                 â”‚ triggers whale crash + global halt     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Agent roles, responsibilities   â”‚ Each agent has perceive/reason/act     â”‚
  â”‚ and interactions explained      â”‚ pipeline, structured decisions with    â”‚
  â”‚                                 â”‚ reasoning, and clear goal. Interaction â”‚
  â”‚                                 â”‚ flow: Market â†’ Agent â†’ Regulator â†’     â”‚
  â”‚                                 â”‚ Execute + whale crash cascade          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Must have a backend             â”‚ Flask REST API (6 endpoints)           â”‚
  â”‚                                 â”‚ Python backend with full business logicâ”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Database / Storage              â”‚ SQLite (devhack.db) with 3 tables      â”‚
  â”‚                                 â”‚ Dual-write: memory + persistent DB     â”‚
  â”‚                                 â”‚ Full audit trail of all trades + eventsâ”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Live demo of functioning agents â”‚ Step-by-step or auto-run mode shows    â”‚
  â”‚                                 â”‚ all agents making real-time decisions   â”‚
  â”‚                                 â”‚ with reasoning visible in UI            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Final output preview / complete â”‚ Full UI: TradingView chart, agent      â”‚
  â”‚ execution result                â”‚ leaderboard, risk metrics, trade logs, â”‚
  â”‚                                 â”‚ regulation events, statistics dashboardâ”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Local code execution            â”‚ Backend: python app.py (port 5000)     â”‚
  â”‚                                 â”‚ Frontend: npm run dev (port 5173)      â”‚
  â”‚                                 â”‚ Runs entirely on localhost              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Continuous recording (5-10 min) â”‚ Full prototype supports single-session â”‚
  â”‚                                 â”‚ demo: init â†’ step â†’ auto-run â†’ crash   â”‚
  â”‚                                 â”‚ â†’ circuit breaker â†’ review all tabs    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ GitHub repo with readable code  â”‚ Public repo with clean directory       â”‚
  â”‚                                 â”‚ structure, docstrings, and this report â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
13. PHASE 2 ENHANCEMENTS (What Changed from Phase 1)
================================================================================

  Backend Changes:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ Agentic Pipeline: All 5 agents refactored from observe_market_state() +
      decide() to perceive() â†’ reason() â†’ act() pipeline with composite
      step() method.  Old methods removed.

    â€¢ Agent Memory: Each agent now stores full pipeline history in a
      memory list[dict] â€” observation, decision, action per step.

    â€¢ Agent Performance Stats: New performance_stats dict tracking
      pnl, wins, losses, max_drawdown.  update_after_step() now has
      real implementation updating these.

    â€¢ Agent Serialization: to_dict() now includes memory_size,
      latest_memory, performance_stats for frontend consumption.

    â€¢ Market Reset: New market.reset() method â€” rewinds to step 0
      without re-downloading data from yfinance.

    â€¢ Orchestrator Reinit: New _reinit_without_download() method for
      fast rewind during jump operations.

    â€¢ Jump Stability: jump_to_step() now disables DB writes during
      replay (logger._db = None in try/finally) to prevent SQLite
      transaction errors.

    â€¢ Safe DB Commits: New _safe_commit() in SimulationDB that checks
      conn.in_transaction before committing.

  Frontend Changes:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ Complete UI Redesign: 2-column layout replaced with 3-column
      layout (72px sidebar + 1fr center + 310px controls).

    â€¢ Tab Navigation: New LeftSidebar with 5 tabs (Trades, Market,
      Agents, Stats, Help). Only active tab's content is rendered.

    â€¢ TopBar: New sticky header with stock selector, portfolio balance
      (â‚¹), crash indicator, theme toggle, profile button.

    â€¢ RightTradePanel: Replaced ControlsPanel as the primary control
      surface (interval selector, speed/batch sliders, agent toggles,
      action buttons).

    â€¢ TradingView Charts: PriceChart completely rewritten from Recharts
      to TradingView Lightweight Charts v5. Professional candlestick
      rendering with crosshair, floating legend, and series markers.

    â€¢ AgentsPanel Rewrite: 687-line rich component with SparkBar charts,
      risk metric chips, expandable trade history + AI pipeline view.
      Now shows Orchestrator + Regulator system agent cards at top.

    â€¢ MarketPanel: New â€” OHLC grid, technical indicators, SMA crossover
      signal, volatility meter with gradient bar.

    â€¢ StatsPanel: New â€” AUM summary, trading activity metrics, agent
      leaderboard, aggregate risk metrics.

    â€¢ HelpPanel: New â€” in-app documentation with 7 agent descriptions
      (system + trading), AI pipeline visualization with escalation
      note, controls guide, tech stack.

    â€¢ Regulator Escalation: New RepeatOffender rule â€” â‰¥5 cumulative
      warnings â†’ BLOCK + 10-step cooldown.  Backend snapshot now
      includes regulator_agent block (approvals, warnings, blocks,
      rules_enforced, compliance status).  AgentsPanel receives and
      displays this as a dedicated Regulator card with live stats.

    â€¢ Theme System: Dark + Light theme with localStorage persistence.
      58 CSS custom properties. Glassmorphism card styling.

    â€¢ Neon Aesthetic: Space Grotesk + Inter + JetBrains Mono fonts.
      Neon color palette: cyan #00d4ff, green #00ff88, purple #a855f7,
      amber #ffb800, red #ff3b5c.

    â€¢ Currency: All USD ($) changed to INR (â‚¹) across all components.

    â€¢ Scrubber Improvements: Debounced drag (fires on release only),
      maxReachedStep enforcement, jumpingRef mutex for concurrent
      jump prevention.

    â€¢ Responsive Design: 3 breakpoints (1400px, 1024px, 640px) vs
      single breakpoint in Phase 1.

    â€¢ CSS: 585 lines â†’ 1066 lines.


================================================================================
14. HOW TO RUN
================================================================================

  Prerequisites:
    â€¢ Python 3.11+
    â€¢ Node.js 18+

  Backend:
    cd backend
    pip install -r requirements.txt
    python app.py
    # Runs on http://localhost:5000

  Frontend:
    cd frontend
    npm install
    npm run dev
    # Runs on http://localhost:5173

  Open http://localhost:5173 in a browser.
  Select a ticker from the TopBar â†’ choose period â†’ click "Initialize"
  in the right panel â†’ use "Run" for auto-run or "Step" for manual.


================================================================================
15. DEPENDENCIES
================================================================================

  Backend (requirements.txt):
    flask         >= 3.0
    flask-cors    >= 4.0
    yfinance      >= 0.2
    pandas        >= 2.0
    numpy         >= 1.24
    (sqlite3 is built into Python)

  Frontend (package.json):
    react              ^18.3.0
    react-dom          ^18.3.0
    lightweight-charts  ^5.1.0     â† TradingView charting (Phase 2)
    recharts           ^2.12.0
    axios              ^1.7.0
    vite               ^5.4.0     (dev)
    @vitejs/plugin-react ^4.3.0   (dev)


================================================================================
END OF REPORT
================================================================================
